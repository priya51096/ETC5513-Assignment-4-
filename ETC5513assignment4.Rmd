---
title: "Immigration Report"
author:
- familyname: Dingorkar
  othernames: Priya Ravindra
  address: Monash University
  email: pdin0008@student.monash.edu
  qualifications:  BE in Computer Enginnering, Pursing Master of Business Analytics
  correspondingauthor: true
- familyname: Babu
  othernames: Aarathy
  address: Monash University
  email: abab0012@student.monash.edu
  qualifications:  B.Tech
- familyname: Wang
  othernames: Junhao
  address: Monash University
  email: jwan0296@student.monash.edu
  qualifications: Accounting
- familyname: XXX (Please add your details Dilinie)
  othernames: XXX
  address: XXX
  email: XXX
  qualifications:  XXX
  correspondingauthor: true
department: ETC5513, Group 11\newline Junhao &\newline Aarathy &\newline Dilinie &\newline Priya
organization: Australian Government COVID19
bibliography: references.bib
biblio-style: authoryear-comp
linestretch: 1.5
output:
  bookdown::pdf_document2:
    template: monashreport2.tex
    fig_caption: yes
    fig_height: 5
    fig_width: 8
    includes:
      in_header: preamble.tex
    keep_tex: yes
    number_sections: yes
    citation_package: biblatex
    toc: false
---

```{r , echo = FALSE, message = FALSE, warning = FALSE}
# Libraries

library(tidyverse)
library(readr)
library(kableExtra)
library(bookdown)
library(scales)
library(naniar)

```



\section*{Introduction}

\section*{Abstract}

\section*{Methodology}

\section*{File A1}

```{r}

file1 <- read.csv("data/DIOC_2015_16_File_A_1.csv")

```


```{r datacleaning}
whomigrates<- file1 %>% 
  mutate(edu_lfs = as.character(edu_lfs),
         age_lfs=as.character(age_lfs),
         sex=as.character(sex),
         national=as.character(national),
         oecd=as.character(oecd),
         oecdb=as.character(oecdb),
         fborn=as.character(fborn)
         ) %>% 
         mutate(
           age_lfs = case_when(
    str_detect(age_lfs,"0") ~ "0-14",
     str_detect(age_lfs,"1") ~ "15-24",
 str_detect(age_lfs,"2") ~ "25-64",
 str_detect(age_lfs,"3") ~ "65+",
 str_detect(age_lfs,"12") ~ "15-84",
 str_detect(age_lfs,"99") ~ "Unknown" 
 )) %>%
  mutate(sex = case_when(
   str_detect(sex,"1") ~ "Male",
   str_detect(sex,"2")~ "Female"
 )) %>%
  mutate(edu_lfs = case_when(
    str_detect(edu_lfs,"1")~"low",
    str_detect(edu_lfs,"2")~"medium",
    str_detect(edu_lfs,"3")~"high",
    str_detect(edu_lfs,"99")~"unknown"
  )) %>% 
      mutate(national = case_when(
    str_detect(national,"0") ~ "Foreigner",
     str_detect(national,"1") ~ "National",
     str_detect(national,"99")~"unknown"
    
  )) %>% mutate(oecd = case_when(
    
    str_detect(oecd,"0") ~ "Non member",
     str_detect(oecd,"1") ~ "Member"
    
  )) %>% mutate(oecdb = case_when(
    
    str_detect(oecdb,"0") ~ "Non member",
     str_detect(oecdb,"1") ~ "Member"
    
  )) %>% mutate(fborn = case_when(
    
    str_detect(fborn,"0") ~ " Native-born",
     str_detect(fborn,"1") ~ " Foreign-born ",
     str_detect(fborn,"99")~"unknown"
    
  )) %>% replace_with_na (replace =
                    list(edu_lfs = "unknown",
                         national = "unknown",
                         fborn = "unknown"
                        ))



            

```

```{r topdestinations}

whomigrates %>%  mutate(
         sex=as.factor(sex),
         oecd=as.factor(oecd),#oecd resident
         oecdb=as.factor(oecdb),#oecd born
         age_lfs=as.factor(age_lfs),
         edu_lfs =as.factor(edu_lfs)
         ) %>% 
  group_by(country) %>% summarise(totsmigrants=sum(number)) %>% arrange(desc(totsmigrants)) %>% head(10) %>% 
  
  
  kable(caption="top 10 destinations") %>% 
kable_styling(bootstrap_options= c("striped","condensed"),full_width = F,fixed_thead = T)

```



```{r gendergap}

options(scipen=999)
gendergap <- whomigrates %>% 
  mutate(
         sex=as.factor(sex),
         oecd=as.factor(oecd),#oecd resident
         oecdb=as.factor(oecdb),#oecd born
         age_lfs=as.factor(age_lfs)
         ) %>% 
  group_by(sex,country)%>% summarise(n=sum(number)) 
   
  gendergap %>% 
    ggplot(aes(x= fct_reorder(country,n),y=n,fill=sex)) +
    geom_col(position = "dodge")+ 
    theme_bw()+theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
    scale_colour_brewer(palette = "Set1")+ 
    scale_y_continuous(labels = comma)



```


```{r}
agegap <- whomigrates  %>% 
  mutate(
         sex=as.factor(sex),
         oecd=as.factor(oecd),#oecd resident
         oecdb=as.factor(oecdb),#oecd born
         age_lfs=as.factor(age_lfs)
         ) %>%
  filter(age_lfs!= c("0-14","Unknown")) %>%
  group_by(age_lfs,sex,country) %>% 
  summarise(total=sum(number))
  `%notin%` <- Negate(`%in%`)
 agegap%>%  
  filter(age_lfs %notin% c("0-14","Unknown")) %>%
  ggplot(aes(x = country,y = total,fill = sex)) +

  
    geom_col(position = "dodge")+ 
    theme_bw()+theme(axis.text.x = element_text(angle = 90, hjust = 1)) + 
    scale_colour_brewer(palette = "Set1")+ 
    scale_y_continuous(labels = comma) + facet_wrap(~age_lfs,nrow = 3)


```




